<div class="main-content">
  <div class="automation-container">
    <h1 class="title">Report Automation</h1>

    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      <!-- Report Configuration -->
      <div formGroupName="report">
        <h2 data-step="1">Report Configuration</h2>
        <label for="reportType">Report Type:</label>
        <select id="reportType" formControlName="reportType">
          <option *ngFor="let report of allowedReportTypes" [value]="report.value">
            {{ report.label }}
          </option>
        </select>

        <!-- Fixed Export Format = PDF -->
<label for="format">Export Format:</label> 
        <div class="format-display">
          <span class="format-value">PDF</span>
        </div>
        <!-- Hidden form control to maintain form structure -->
        <input type="hidden" formControlName="format" value="pdf">
      </div>   

      <!-- Schedule Configuration -->
      <div formGroupName="schedule">
        <h2 data-step="2">Schedule Configuration</h2>
        <label for="frequency">Frequency:</label>
        <select id="frequency" formControlName="frequency">
          <option value="daily">Daily</option>
          <option value="weekly">Weekly</option>
          <option value="monthly">Monthly</option>
        </select>

        <label for="time">Time:</label>
        <input type="time" id="time" formControlName="time">

        <div *ngIf="form.get('schedule.frequency')?.value === 'weekly'">
          <label for="dayOfWeek">Day of Week:</label>
          <select id="dayOfWeek" formControlName="dayOfWeek">
            <option value="1">Monday</option>
            <option value="2">Tuesday</option>
            <option value="3">Wednesday</option>
            <option value="4">Thursday</option>
            <option value="5">Friday</option>
            <option value="6">Saturday</option>
            <option value="7">Sunday</option>
          </select>
        </div>

        <div *ngIf="form.get('schedule.frequency')?.value === 'monthly'">
          <label for="dayOfMonth">Day of Month:</label>
          <select id="dayOfMonth" formControlName="dayOfMonth">
            <option *ngFor="let day of daysOfMonth" [value]="day">{{ day }}</option>
          </select>
        </div>
      </div>

      <!-- Recipient Configuration -->
      <div formGroupName="recipient">
        <h2 data-step="3">Recipients</h2>
        <label for="emails">Email Recipients:</label>
        <input
  type="email"
  formControlName="emails"
  class="form-control"
  [disabled]="true"
/>

        <label for="subject">Email Subject:</label>
        <input type="text" id="subject" formControlName="subject" placeholder="Email Subject">

        <label for="message">Message:</label>
        <textarea id="message" formControlName="message" placeholder="Message body"></textarea>
      </div>

      <button type="submit" [disabled]="!form.valid">
        {{ editingAutomationId !== null ? 'Update' : 'Save' }} Automation
      </button>
      <button type="button" class="clear-btn" (click)="cancel()">Clear Form</button>

    </form>

    <!-- Grouped Automations -->
    <div *ngIf="groupedAutomations | keyvalue as honeyCombGroups" style="margin-top:40px;">
      <h2 data-step="4">Active Automations</h2>
      <div *ngFor="let group of honeyCombGroups">
        <!-- <h3>{{ group.key }}</h3> -->
        <div *ngFor="let automation of group.value"
             style="display:flex; align-items:center; justify-content:space-between; padding: 8px 0; border-bottom: 1px solid #eee;">
          <p style="margin:0;">
            <strong>{{ automation.reportType }}</strong> | {{ automation.frequency }} at {{ automation.time }}
          </p>
          <div class="automation-actions">
            <button class="edit-btn" (click)="editAutomation(automation)">Edit</button>
            <button class="delete-btn" (click)="deleteAutomation(automation.id.toString())">Delete</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
