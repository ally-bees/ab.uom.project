
<div class="signup-container">
  <div class="left-panel">
    <div class="brand-content">
      <h3>Effortless reporting and data insights?</h3>
      <h2>InstaDash Reporting</h2>
      <p>empowers your business.</p>

      <div class="logo">
        <img src="assets/logo2.png" alt="InstaDash Logo">
      </div>
    </div>
  </div>

  <div class="right-panel">
    <div class="form-container">
      
      <!-- Step 1: Registration Form -->
      <div *ngIf="!showOtpStep">
        <h2>Create a new Account.</h2>

        <form [formGroup]="signupForm" (ngSubmit)="onSubmit()">
          <div class="alert alert-danger" *ngIf="error">{{ error }}</div>

          <div class="form-group">
            <input 
              type="text"
              placeholder="Username"
              formControlName="username"
              [ngClass]="{ 'invalid': f['username'].touched && f['username'].invalid }"
            />
            <div *ngIf="f['username'].touched && f['username'].invalid" class="invalid-feedback">
              <div *ngIf="f['username'].errors?.['required']">Username is required</div>
              <div *ngIf="f['username'].errors?.['minlength']">Must be at least 6 characters</div>
            </div>
          </div>

          <div class="form-group">
            <input 
              type="email"
              placeholder="Email"
              formControlName="email"
              [ngClass]="{ 'invalid': f['email'].touched && f['email'].invalid }"
            />
            <div *ngIf="f['email'].touched && f['email'].invalid" class="invalid-feedback">
              <div *ngIf="f['email'].errors?.['required']">Enter the Email used in honeycomb</div>
              <div *ngIf="f['email'].errors?.['email']">Please enter a valid email</div>
            </div>
          </div>

          <div class="form-group">
            <input 
              type="password"
              placeholder="Password"
              formControlName="password"
              [ngClass]="{ 'invalid': f['password'].touched && f['password'].invalid }"
            />
            <div *ngIf="f['password'].touched && f['password'].invalid" class="invalid-feedback">
              <div *ngIf="f['password'].errors?.['required']">Password is required</div>
              <div *ngIf="f['password'].errors?.['minlength']">At least 8 characters</div>
            </div>
          </div>

          <div class="form-group">
            <input 
              type="password"
              placeholder="Confirm Password"
              formControlName="confirmPassword"
              [ngClass]="{ 'invalid': f['confirmPassword'].touched && f['confirmPassword'].invalid }"
            />
            <div *ngIf="f['confirmPassword'].touched && f['confirmPassword'].invalid" class="invalid-feedback">
              <div *ngIf="f['confirmPassword'].errors?.['required']">Please confirm your password</div>
              <div *ngIf="f['confirmPassword'].errors?.['mustMatch']">Passwords must match</div>
            </div>
          </div>

          <div class="form-group">
            <input 
              type="text"
              placeholder="Honeycomb ID"
              formControlName="honeycombId"
              [ngClass]="{ 'invalid': f['honeycombId'].touched && f['honeycombId'].invalid }"
            />
            <div *ngIf="f['honeycombId'].touched && f['honeycombId'].invalid" class="invalid-feedback">
              <div *ngIf="f['honeycombId'].errors?.['required']">Honeycomb ID is required</div>
            </div>
          </div>

          <div class="terms-section">
            <p>
              By signing up, you agree to our 
              <a routerLink="/terms-of-service" class="terms-link">terms of service</a> and 
              <a routerLink="/privacy-policy" class="terms-link">privacy policy</a>
            </p>
          </div>

          <button type="submit" class="signup-btn" [disabled]="signupForm.invalid || loading">
            <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
            Sign up
          </button>
        </form>

        <div class="login-link">
          Already have an account? <a routerLink="/login" class="signin-link">Sign-in here</a>
        </div>
      </div>

      <!-- Step 2: OTP Verification -->
      <div *ngIf="showOtpStep">
        <div class="otp-header">
          <button type="button" class="back-btn" (click)="goBackToSignup()">
            <i class="fas fa-arrow-left"></i>
          </button>
          <h2>Verify Your Email</h2>
        </div>

        <div class="otp-info">
          <div class="otp-icon">
            <i class="fas fa-envelope-open-text"></i>
          </div>
          <p class="otp-message">
            We've sent a 6-digit verification code to<br>
            <strong>{{ email }}</strong>
          </p>
          <p class="otp-instruction">Enter the code below to complete your registration.</p>
        </div>

        <form [formGroup]="otpForm" (ngSubmit)="onOtpSubmit()">
          <div class="alert alert-danger" *ngIf="error">{{ error }}</div>

          <div class="form-group">
            <input 
              type="text"
              placeholder="Enter 6-digit code"
              formControlName="otpCode"
              maxlength="6"
              class="otp-input"
              [ngClass]="{ 'invalid': otpF['otpCode'].touched && otpF['otpCode'].invalid }"
              #otpInput
            />
            <div *ngIf="otpF['otpCode'].touched && otpF['otpCode'].invalid" class="invalid-feedback">
              <div *ngIf="otpF['otpCode'].errors?.['required']">Verification code is required</div>
              <div *ngIf="otpF['otpCode'].errors?.['pattern']">Please enter a valid 6-digit code</div>
              <div *ngIf="otpF['otpCode'].errors?.['minlength'] || otpF['otpCode'].errors?.['maxlength']">Code must be exactly 6 digits</div>
            </div>
          </div>

          <button type="submit" class="verify-btn" [disabled]="otpForm.invalid || loading">
            <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
            Verify & Complete Registration
          </button>
        </form>

        <div class="resend-section">
          <p *ngIf="!resendDisabled">
            Didn't receive the code? 
            <button type="button" class="resend-btn" (click)="resendOtp()" [disabled]="loading">
              Resend Code
            </button>
          </p>
          <p *ngIf="resendDisabled" class="resend-timer">
            Resend available in {{ resendCountdown }}s
          </p>
        </div>
      </div>
    </div>
  </div>
</div>